  - name: Gather stored entitlement from repository service
    local_action:
      module: uri
      url: "10.128.88.10:9000/api"
      method: GET
      url_username: "{{ ansible_user }}"
      url_password: "{{ ansible_password }}"
      validate_certs: yes
      return_content: yes
      status_code: 200
      body_format: json
    check_mode: false
    register: result

  - name: Show result
    debug:
      msg: "{{ result.json }}"
    check_mode: false




- name: Using a REST API
  become: false
  gather_facts: false
  tasks:
    - debug:
        msg: “Let’s call an API”

    - name: Everyone loves a good Chuck Norris joke
      uri:
        url: 10.128.88.10:9000/api/stacks?method=repository&type=1&endpointId=1
        method: POST
        body_format: json
        body:
          Authorization: "Bearer ptr_sY8k6lKixEFy3rJ/2P5cnxoGJmqdohC6jm9HaJEc1l4="
          Name: "myTestStack"
          SwarmID: "k427pd86wfkgp40ksrmbojrwq"
          RepositoryURL: "https://github.com/portainer/templates"
          ComposeFilePathInRepository: "stacks/cockroachdb/docker-stack.yml"
